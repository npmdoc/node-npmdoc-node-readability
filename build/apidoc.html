<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/luin/node-readability"

    >node-readability (v2.2.0)</a>
</h1>
<h4>Turning any web page into a clean view.</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-readability">module node-readability</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-readability.node-readability">
            function <span class="apidocSignatureSpan"></span>node-readability
            <span class="apidocSignatureSpan">(html, options, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-readability.read">
            function <span class="apidocSignatureSpan">node-readability.</span>read
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">node-readability.</span>helpers</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-readability.helpers">module node-readability.helpers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-readability.helpers.debug">
            function <span class="apidocSignatureSpan">node-readability.helpers.</span>debug
            <span class="apidocSignatureSpan">(debug)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-readability.helpers.getInnerText">
            function <span class="apidocSignatureSpan">node-readability.helpers.</span>getInnerText
            <span class="apidocSignatureSpan">(e, normalizeSpaces)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-readability.helpers.grabArticle">
            function <span class="apidocSignatureSpan">node-readability.helpers.</span>grabArticle
            <span class="apidocSignatureSpan">(document, preserveUnlikelyCandidates)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-readability.helpers.prepDocument">
            function <span class="apidocSignatureSpan">node-readability.helpers.</span>prepDocument
            <span class="apidocSignatureSpan">(document)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-readability.helpers.setCleanRules">
            function <span class="apidocSignatureSpan">node-readability.helpers.</span>setCleanRules
            <span class="apidocSignatureSpan">(rules)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-readability" id="apidoc.module.node-readability">module node-readability</a></h1>


    <h2>
        <a href="#apidoc.element.node-readability.node-readability" id="apidoc.element.node-readability.node-readability">
        function <span class="apidocSignatureSpan"></span>node-readability
        <span class="apidocSignatureSpan">(html, options, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(html, options, callback) {
  if (typeof options === &#x27;function&#x27;) {
    callback = options;
    options = {};
  }

  var overrideEncoding = options.encoding,
      preprocess = options.preprocess;

  options.encoding = null;
  delete options.preprocess;

  var parsedURL = urllib.parse(html);
  if ([&#x27;http:&#x27;, &#x27;https:&#x27;, &#x27;unix:&#x27;, &#x27;ftp:&#x27;, &#x27;sftp:&#x27;].indexOf(parsedURL.protocol) === -1) {
    jsdomParse(null, null, html);
  } else {
    request(html, options, function(err, res, buffer) {
      if (err) {
        return callback(err);
      }

      var content_type = _parseContentType(res.headers[&#x27;content-type&#x27;]);

      if (content_type.mimeType == &#x22;text/html&#x22;) {
        content_type.charset = _findHTMLCharset(buffer) || content_type.charset;
      }

      content_type.charset = (overrideEncoding || content_type.charset || &#x22;utf-8&#x22;).trim().toLowerCase();

      if (!content_type.charset.match(/^utf-?8$/i)) {
        buffer = encodinglib.convert(buffer, &#x22;UTF-8&#x22;, content_type.charset);
      }

      buffer = buffer.toString();

      if (preprocess) {
        preprocess(buffer, res, content_type, function(err, buffer) {
          if (err) return callback(err);
          jsdomParse(null, res, buffer);
        });
      } else {
        jsdomParse(null, res, buffer);
      }
    });
  }

  function jsdomParse(error, meta, body) {
    if (error) {
      return callback(error);
    }

    if (typeof body !== &#x27;string&#x27;) body = body.toString();
    if (!body) return callback(new Error(&#x27;Empty story body returned from URL&#x27;));
    jsdom.env({
      html: body,
      done: function(errors, window) {
        if (meta) {
          window.document.originalURL = meta.request.uri.href;
        } else {
          window.document.originalURL = null;
        }

        if (errors) {
          window.close();
          return callback(errors);
        }
        if (!window.document.body) {
          window.close();
          return callback(new Error(&#x27;No body tag was found.&#x27;));
        }

        try {
          var readability = new Readability(window, options);

          // add meta information to callback
          callback(null, readability, meta);
        } catch (ex) {
          window.close();
          return callback(ex);

        }
      }
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-readability.read" id="apidoc.element.node-readability.read">
        function <span class="apidocSignatureSpan">node-readability.</span>read
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">read = function () {
  console.warn(&#x27;`readability.read` is deprecated. Just use `var read = require(&#x22;node-readability&#x22;); read(url...);`.&#x27;);
  return read.apply(this, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-readability.helpers" id="apidoc.module.node-readability.helpers">module node-readability.helpers</a></h1>


    <h2>
        <a href="#apidoc.element.node-readability.helpers.debug" id="apidoc.element.node-readability.helpers.debug">
        function <span class="apidocSignatureSpan">node-readability.helpers.</span>debug
        <span class="apidocSignatureSpan">(debug)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">debug = function (debug) {
  dbg = (debug) ? console.log : function() {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var jsdom = require(&#x27;jsdom&#x27;);
var request = require(&#x27;request&#x27;);
var helpers = require(&#x27;./helpers&#x27;);
var encodinglib = require(&#x22;encoding&#x22;);
var urllib = require(&#x27;url&#x27;);

exports.debug = function(debug) {
helpers.<span class="apidocCodeKeywordSpan">debug</span>(debug);
};

exports.debug(false);

function Readability(window, options) {
this._window = window;
this._document = window.document;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-readability.helpers.getInnerText" id="apidoc.element.node-readability.helpers.getInnerText">
        function <span class="apidocSignatureSpan">node-readability.helpers.</span>getInnerText
        <span class="apidocSignatureSpan">(e, normalizeSpaces)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getInnerText = function (e, normalizeSpaces) {
  var textContent = &#x22;&#x22;;

  normalizeSpaces = (typeof normalizeSpaces == &#x27;undefined&#x27;) ? true : normalizeSpaces;

  textContent = e.textContent.trim();

  if (normalizeSpaces) return textContent.replace(regexps.normalizeRe, &#x22; &#x22;);
  else return textContent;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  console.warn(&#x27;The method `getContent()` is deprecated, using `content` property instead.&#x27;);
}
if (typeof this.cache[&#x27;article-content&#x27;] !== &#x27;undefined&#x27;) {
  return this.cache[&#x27;article-content&#x27;];
}

var articleContent = helpers.grabArticle(this._document);
if (helpers.<span class="apidocCodeKeywordSpan">getInnerText</span>(articleContent, false) === &#x27;&#x27;) {
  this._document.body.innerHTML = this.cache.body;
  articleContent = helpers.grabArticle(this._document, true);
  if (helpers.getInnerText(articleContent, false) === &#x27;&#x27;) {
    return this.cache[&#x27;article-content&#x27;] = false;
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-readability.helpers.grabArticle" id="apidoc.element.node-readability.helpers.grabArticle">
        function <span class="apidocSignatureSpan">node-readability.helpers.</span>grabArticle
        <span class="apidocSignatureSpan">(document, preserveUnlikelyCandidates)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">grabArticle = function (document, preserveUnlikelyCandidates) {
<span class="apidocCodeCommentSpan">  /**
   * First, node prepping. Trash nodes that look cruddy (like ones with the class name &#x22;comment&#x22;, etc), and turn divs
   * into P tags where they have been used inappropriately (as in, where they contain no other block level elements.)
   *
   * Note: Assignment from index for performance. See http://www.peachpit.com/articles/article.aspx?p=31567&#x26;seqNum=5
   * TODO: Shouldn&#x27;t this be a reverse traversal?
   **/
</span>  var nodes = document.getElementsByTagName(&#x27;*&#x27;);
  for (var i = 0; i &#x3c; nodes.length; ++i) {
    var node = nodes[i];
    // Remove unlikely candidates */
    var continueFlag = false;
    if (!preserveUnlikelyCandidates) {
      var unlikelyMatchString = node.className + node.id;
      if (unlikelyMatchString.search(regexps.unlikelyCandidatesRe) !== -1 &#x26;&#x26; unlikelyMatchString.search(regexps.okMaybeItsACandidateRe
) == -1 &#x26;&#x26; node.tagName !== &#x27;HTML&#x27; &#x26;&#x26; node.tagName !== &#x22;BODY&#x22;) {
        dbg(&#x22;Removing unlikely candidate - &#x22; + unlikelyMatchString);
        node.parentNode.removeChild(node);
        continueFlag = true;
      }
    }

    // Turn all divs that don&#x27;t have children block level elements into p&#x27;s
    if (!continueFlag &#x26;&#x26; node.tagName === &#x27;DIV&#x27;) {
      if (node.innerHTML.search(regexps.divToPElementsRe) === -1) {
        dbg(&#x22;Altering div to p&#x22;);
        var newNode = document.createElement(&#x27;p&#x27;);
        newNode.innerHTML = node.innerHTML;
        node.parentNode.replaceChild(newNode, node);
      } else {
        // EXPERIMENTAL
        Array.prototype.slice.call(node.childNodes).forEach(function(childNode) {
          if (childNode.nodeType == 3 /*TEXT_NODE*/ ) {
            // use span instead of p. Need more tests.
            dbg(&#x22;replacing text node with a span tag with the same content.&#x22;);
            var span = document.createElement(&#x27;span&#x27;);
            span.innerHTML = childNode.nodeValue;
            childNode.parentNode.replaceChild(span, childNode);
          }
        });
      }
    }
  }

  /**
   * Loop through all paragraphs, and assign a score to them based on how content-y they look.
   * Then add their score to their parent node.
   *
   * A score is determined by things like number of commas, class names, etc. Maybe eventually link density.
   **/
  var allParagraphs = document.getElementsByTagName(&#x22;p&#x22;);
  var candidates = [];

  for (var i = 0; i &#x3c; allParagraphs.length; ++i) {
    var paragraph = allParagraphs[i];
    var parentNode = paragraph.parentNode;
    var grandParentNode = parentNode.parentNode;
    var innerText = getInnerText(paragraph);

    // If this paragraph is less than 25 characters, don&#x27;t even count it.
    if (innerText.length &#x3c; 25) continue;

    // Initialize readability data for the parent.
    if (typeof parentNode.readability == &#x27;undefined&#x27;) {
      initializeNode(parentNode);
      candidates.push(parentNode);
    }

    // Initialize readability data for the grandparent.
    if (typeof grandParentNode.readability == &#x27;undefined&#x27;) {
      initializeNode(grandParentNode);
      candidates.push(grandParentNode);
    }

    var contentScore = 0;

    // Add a point for the paragraph itself as a base. */
    ++contentScore;

    // Add points for any commas within this paragraph */
    contentScore += innerText.replace(&#x27;，&#x27;, &#x27;,&#x27;).split(&#x27;,&#x27;).length;

    // For every 100 characters in this paragraph, add another point. Up to 3 points. */
    contentScore += Math.min(Math.floor(innerText.length / 100), 3);

    // Add the score to the parent. The grandparent gets half. */
    parentNode.readability.contentScore += contentScore;
    grandParentNode.readability.contentScore += contentScore / 2;
  }


  /**
   * After we&#x27;ve calculated scores, loop through all of the possible candidate nodes we found
   * and find the one with the highest score.
   **/
  var topCandidate = null;
  candidates.forEach(function(candidate) {
    /**
     * Scale the final candidates score based on link density. Good content should have a
     * relatively small link density (5% or less) and be mostly unaffected by this operation. ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...
if (!notDeprecated) {
  console.warn(&#x27;The method `getContent()` is deprecated, using `content` property instead.&#x27;);
}
if (typeof this.cache[&#x27;article-content&#x27;] !== &#x27;undefined&#x27;) {
  return this.cache[&#x27;article-content&#x27;];
}

var articleContent = helpers.<span class="apidocCodeKeywordSpan">grabArticle</span>(this._document);
if (helpers.getInnerText(articleContent, false) === &#x27;&#x27;) {
  this._document.body.innerHTML = this.cache.body;
  articleContent = helpers.grabArticle(this._document, true);
  if (helpers.getInnerText(articleContent, false) === &#x27;&#x27;) {
    return this.cache[&#x27;article-content&#x27;] = false;
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-readability.helpers.prepDocument" id="apidoc.element.node-readability.helpers.prepDocument">
        function <span class="apidocSignatureSpan">node-readability.helpers.</span>prepDocument
        <span class="apidocSignatureSpan">(document)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">prepDocument = function (document) {
  var frames = document.getElementsByTagName(&#x27;frame&#x27;);
  if (frames.length &#x3e; 0) {
    var bestFrame = null;
    var bestFrameSize = 0;

    Array.prototype.slice.call(frames, 0).forEach(function(frame) {
      var frameSize = frame.offsetWidth + frame.offsetHeight;
      var canAccessFrame = false;
      try {
        frame.contentWindow.document.body;
        canAccessFrame = true;
      } catch (e) {}

      if (canAccessFrame &#x26;&#x26; frameSize &#x3e; bestFrameSize) {
        bestFrame = frame;
        bestFrameSize = frameSize;
      }
    });

    if (bestFrame) {
      var newBody = document.createElement(&#x27;body&#x27;);
      newBody.innerHTML = bestFrame.contentWindow.document.body.innerHTML;
      newBody.style.overflow = &#x27;scroll&#x27;;
      document.body = newBody;

      var frameset = document.getElementsByTagName(&#x27;frameset&#x27;)[0];
      if (frameset) {
        frameset.parentNode.removeChild(frameset);
      }
    }
  }

  // turn all double br&#x27;s into p&#x27;s
  // note, this is pretty costly as far as processing goes. Maybe optimize later.
  // document.body.innerHTML = document.body.innerHTML.replace(regexps.replaceBrsRe, &#x27;&#x3c;/p&#x3e;&#x3c;p&#x3e;&#x27;).replace(regexps.replaceFontsRe, &#x27;&#x3c;$
1span&#x3e;&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// Cache the body HTML in case we need to re-use it later
this.bodyCache = null;
this._articleContent = &#x27;&#x27;;
helpers.setCleanRules(options.cleanRulers || []);

this.cache = {};

helpers.<span class="apidocCodeKeywordSpan">prepDocument</span>(this._document);
this.cache = {
  &#x27;body&#x27;: this._document.body.innerHTML
};

this.__defineGetter__(&#x27;content&#x27;, function() {
  return this.getContent(true);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-readability.helpers.setCleanRules" id="apidoc.element.node-readability.helpers.setCleanRules">
        function <span class="apidocSignatureSpan">node-readability.helpers.</span>setCleanRules
        <span class="apidocSignatureSpan">(rules)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setCleanRules = function (rules) {
  cleanRules = rules;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
function Readability(window, options) {
this._window = window;
this._document = window.document;
this.iframeLoads = 0;
// Cache the body HTML in case we need to re-use it later
this.bodyCache = null;
this._articleContent = &#x27;&#x27;;
helpers.<span class="apidocCodeKeywordSpan">setCleanRules</span>(options.cleanRulers || []);

this.cache = {};

helpers.prepDocument(this._document);
this.cache = {
  &#x27;body&#x27;: this._document.body.innerHTML
};
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
